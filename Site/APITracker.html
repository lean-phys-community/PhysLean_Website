---
layout: default
---

<!-- Some style choices -->

<style>
    :root {
        --bg-color: #2E3440;
        --fg-color: #D8DEE9;
        --link-color: #81A1C1;
        --button-bg: #4CAF50;
        --button-text: #FFFFFF;
        --border-color: #4C566A;
        --list-bg: #3B4252;
        --list-text: #A3BE8C;
    }



    a {
        color: var(--link-color);
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    #graph {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 20px;
        background-color: #fff;
        /* Graph background is usually white */
    }

    ul {
        list-style-type: disc;
        padding-left: 20px;
    }

    li {
        margin-bottom: 8px;
    }

    .custom-graph-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .list-container {
        flex: 1;
        min-width: 300px;
    }

    #sources-list,
    #targets-list {
        height: 200px;
        overflow-y: auto;
        border: 1px solid var(--border-color);
        background-color: var(--list-bg);
        color: var(--list-text);
        font-family: monospace;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.9em;
    }

    #sources-list div,
    #targets-list div {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 2px 0;
    }

    input[type="checkbox"] {
        accent-color: var(--button-bg);
    }

    #renderBtn {
        font-size: 1.2em;
        padding: 10px 20px;
        margin-top: 1em;
        background-color: var(--button-bg);
        color: var(--button-text);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        width: 100%;
    }

    #renderBtn:hover {
        background-color: #45a049;
    }

    code {
        background-color: var(--list-bg);
        color: var(--list-text);
        padding: 2px 5px;
        border-radius: 4px;
    }
</style>
<!-- Downloading d3js -->

<script src="//d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/@hpcc-js/wasm@2.20.0/dist/graphviz.umd.js"></script>
<script src="https://unpkg.com/d3-graphviz@5.6.0/build/d3-graphviz.js"></script>

<div id="graph-container" style="text-align: center; margin-top: 30px;">
    <h2>API Dependency Graph</h2>
    <div id="graph"></div>
</div>

This graph is to help visulaize the APIs related issues for PhysLean. This grpah is new and currently under development. But 
feel free to explore the issues and help where you can! This graph does not currently show progress of the APIs been built, 
as some issues have not yet defined their requirements, even though the requirements may already exist in PhysLean.

<script>
    fetch('https://api.github.com/repos/HEPLean/PhysLean/issues')
        .then(response => response.json())
        .then(data => {
            const apiIssues = data.filter(issue => 
                issue.labels.some(label => label.name === 'API')
            );
            
            // Parse parent relationships
            const nodes = [];
            const edges = [];
            
            apiIssues.forEach(issue => {
                const needsRequirements = issue.labels.some(label => label.name === 'Requirements needed');
                
                // Count checkboxes in issue body
                const body = issue.body || '';
                const totalCheckboxes = (body.match(/- \[[ x]\]/g) || []).length;
                const checkedBoxes = (body.match(/- \[x\]/g) || []).length;
                
                nodes.push({
                    id: issue.number,
                    title: issue.title,
                    url: issue.html_url,
                    needsRequirements: needsRequirements,
                    totalCheckboxes: totalCheckboxes,
                    checkedBoxes: checkedBoxes
                });
                
                // Extract parent APIs from description
                const parentMatch = issue.body?.match(/## Parent APIs\s+((?:#\d+\s*)+)/);
                if (parentMatch) {
                    const parents = parentMatch[1].match(/#(\d+)/g);
                    if (parents) {
                        parents.forEach(parent => {
                            const parentId = parseInt(parent.substring(1));
                            edges.push({ from: parentId, to: issue.number });
                        });
                    }
                }
            });
            
            // Create DOT notation for graphviz
            let dot = 'digraph G {\n';
            dot += '  rankdir=TB;\n';
            dot += '  node [shape=box, style=filled, fillcolor=lightblue];\n';
            
            nodes.forEach(node => {
                const fillColor = node.needsRequirements ? '#ddb9a9' : 'lightblue';
                const label = node.title.replace(/"/g, '\\"').replace("API: ", "");
                
                let fullLabel;
                if (node.needsRequirements) {
                    fullLabel = `${label}<BR/><FONT POINT-SIZE="10">Next step: Specify requirements</FONT>`;
                } else {
                    fullLabel = `${label}<BR/><FONT POINT-SIZE="10">Next step: Build requirements (${node.checkedBoxes}/${node.totalCheckboxes})</FONT>`;
                }
                
                dot += `  "${node.id}" [label=<${fullLabel}>, fillcolor="${fillColor}", URL="${node.url}"];\n`;
            });
            
            edges.forEach(edge => {
                dot += `  "${edge.from}" -> "${edge.to}";\n`;
            });
            
            dot += '}';
            
            // Render graph with settings
            // Use neato engine for better disconnected component layout
            d3.select("#graph")
                .graphviz()
                .zoom(true)
                .zoomScaleExtent([0.1, Infinity])
                .fit(true)
                .width("100%")
                .engine("dot")
                .renderDot(dot);
        })
        .catch(error => {
            console.error('Error creating graph:', error);
        });
</script>